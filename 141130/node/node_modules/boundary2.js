function parse(s, data, files, post)
{
	//要找的——切
	var bound=new Buffer(s);
	
	var rn=new Buffer('\r\n');
	
	function findInBuffer(b1, b2, start)
	{
		for(var i=start;i<b1.length-(b2.length-1);i++)
		{
			var found=true;
			
			for(var j=0;j<b2.length;j++)
			{
				if(b1[i+j]!=b2[j])
				{
					found=false;
					break;
				}
			}
			
			if(found)
			{
				return i;
			}
		}
		
		return -1;
	}
	
	//找出所有Boundary
	var last=0;
	var pos=[];
	
	while(1)
	{
		var n=findInBuffer(data, bound, last);
		
		if(n==-1)
			break;
		
		pos.push(n);
		
		last=n+bound.length;
	}
	
	//console.log(pos);
	var arrBuffer=[];
	
	for(var i=0;i<pos.length;i++)
	{
		var d=data.slice(pos[i]+bound.length, pos[i+1]);
		arrBuffer.push(d);
	}
	arrBuffer.pop();
	
	//再切
	(function (){
		for(var i=0;i<arrBuffer.length;i++)
		{
			var d=arrBuffer[i];
			
			d=d.slice(2, d.length-2);
			
			//文件信息第一行
			var n=findInBuffer(d, rn, 0);
			var a=d.slice(0, n);
			
			//Content-Disposition: form-data; name="f1"; filename="1.txt"
			var str=a.toString('utf8');
			var json=JSON.parse('{'+str.replace(/; /g, ',"').replace(/=/g, '":').replace(/Content\-Disposition/gi, '"Content-Disposition"').replace(/form\-data/ig, '"form-data"')+'}');
			
			var name=json.name;
			var filename=json.filename;
			
			//console.log(name, filename);
			
			var isFile=true;
			
			if(filename)
			{
				isFile=true;
				//文件信息第二行
				var n2=findInBuffer(d, rn, n+2);
				var b=d.slice(n+2, n2);
				//空行
				var n3=findInBuffer(d, rn, n2+2);
				
				//文件内容
				var c=d.slice(n3+2);
			}
			else
			{
				isFile=false;
				var n2=n+2;
				var c=d.slice(n2+2, d.length-2);
			}
			
			if(isFile)
			{
				files.push({name: name, filename: filename, content: c});
			}
			else
			{
				post[name]=c.toString('utf8');
			}
		}
	})();
}

exports.parse=parse;
