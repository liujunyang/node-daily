   

var urlLib=require('url');
var querystring=require('querystring');

exports.parse=parse;

function parse(req, fn)
{
	var str='';		//风险
	
	req.on('data', function (data){
		str+=data;
	});
	req.on('end', function (){
		//解析
		//GET
		var json=urlLib.parse(req.url, true);
		var url=json.pathname;
		var get=json.query;
		
		//POST
		var post=querystring.parse(str);
		
		//COOKIE
		var cookie={};
		if(req.headers['cookie'])
			cookie=querystring.parse(req.headers['cookie'].replace(/; /g, '&'));
		
		fn && fn(url, get, post, cookie);
	});
}

