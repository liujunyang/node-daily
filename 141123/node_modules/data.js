var urlLib=require('url');
var querystring=require('querystring');

function parseReq(req, fn)
{
	var str='';
	req.on('data', function (data){
		str+=data;
	});
	req.on('end', function (){
		//解析get
		var obj=urlLib.parse(req.url, true);
		
		var url=obj.pathname;
		var get=obj.query;
		
		//解析post
		var post=querystring.parse(str);
		
		//解析cookie
		var cookie={};
		if(req.headers['cookie'])
		{
			cookie=querystring.parse(req.headers['cookie'].replace(/; /g, '&'));
		}
		
		fn({url, get, post, cookie});
	});
}

exports.parseReq=parseReq;

exports.writeCookie=function (cookie, res)
{
	var arr=[];
	for(var i in cookie)
	{
		arr.push(i+'='+cookie[i]);
	}
	res.setHeader('set-cookie', arr);
};





