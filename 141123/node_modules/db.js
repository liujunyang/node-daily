var mysql=require('mysql');
var Event=require('events').EventEmitter;

var db=mysql.createConnection({host: 'localhost', user: 'root', password: '123456', database: 'test'});

var ev=new Event();

//处理错误
/*
ev.on('error', function (err){
	console.log('数据库出错', err);
	
	res.end('{"err": 1, "msg": "数据库出错"}');
});
*/

ev.setMaxListeners(1);

exports.query=function (sql, data, fn)
{
	sql=sql.replace(/\{\w+\}/g, function (s){
		return data[s.substring(1, s.length-1)];
	});
	
	db.query(sql, function (err, data){
		if(err)
			ev.emit('error', err);
		else
			fn(data);
	});
};

exports.ev=ev;






